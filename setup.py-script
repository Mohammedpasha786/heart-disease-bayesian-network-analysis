#!/usr/bin/env python3
"""
Setup script for Heart Disease Detective Project
MediMystery Labs - Data Science Division
"""

import os
import subprocess
import sys
import urllib.request
from pathlib import Path

def print_header():
    """Print project header"""
    print("ğŸ•µï¸" + "=" * 58 + "ğŸ•µï¸")
    print("ğŸ©º HEART DISEASE DETECTIVE - PROJECT SETUP ğŸ©º")
    print("ğŸ¥ MediMystery Labs - Data Science Division ğŸ¥")
    print("ğŸ•µï¸" + "=" * 58 + "ğŸ•µï¸")

def check_python_version():
    """Check if Python version is compatible"""
    print("\nğŸ Checking Python version...")
    
    if sys.version_info < (3, 8):
        print("âŒ Python 3.8+ required. Current version:", sys.version)
        return False
    
    print(f"âœ… Python {sys.version.split()[0]} detected")
    return True

def install_requirements():
    """Install required packages"""
    print("\nğŸ“¦ Installing required packages...")
    
    requirements = [
        'pandas>=1.3.0',
        'numpy>=1.21.0', 
        'matplotlib>=3.4.0',
        'seaborn>=0.11.0',
        'scikit-learn>=1.0.0',
        'pgmpy>=0.1.18',
        'networkx>=2.6.0',
        'jupyter>=1.0.0'
    ]
    
    try:
        for package in requirements:
            print(f"Installing {package}...")
            subprocess.check_call([sys.executable, '-m', 'pip', 'install', package])
        
        print("âœ… All packages installed successfully!")
        return True
        
    except subprocess.CalledProcessError as e:
        print(f"âŒ Error installing packages: {e}")
        return False

def download_dataset():
    """Download the heart disease dataset"""
    print("\nğŸ“Š Setting up dataset...")
    
    dataset_url = "https://bit.ly/3T1A7Rs"
    dataset_file = "heart_disease.csv"
    
    if os.path.exists(dataset_file):
        print(f"âœ… Dataset '{dataset_file}' already exists")
        return True
    
    try:
        print(f"Downloading dataset from {dataset_url}...")
        print("âš ï¸  Please download manually from: https://bit.ly/3T1A7Rs")
        print(f"   Save as: {dataset_file}")
        print("   Place in the project root directory")
        return True
        
    except Exception as e:
        print(f"âŒ Error downloading dataset: {e}")
        print("ğŸ“ Please download manually and save as 'heart_disease.csv'")
        return True

def create_project_structure():
    """Create project directory structure"""
    print("\nğŸ“ Creating project structure...")
    
    directories = [
        'data',
        'results', 
        'visualizations',
        'reports',
        'notebooks'
    ]
    
    for directory in directories:
        Path(directory).mkdir(exist_ok=True)
        print(f"âœ… Created directory: {directory}/")
    
    return True

def create_gitignore():
    """Create .gitignore file"""
    print("\nğŸ“„ Creating .gitignore...")
    
    gitignore_content = """# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# Distribution / packaging
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# PyInstaller
*.manifest
*.spec

# Jupyter Notebook
.ipynb_checkpoints

# pyenv
.python-version

# Environment variables
.env
.venv
env/
venv/

# Data files (keep structure, ignore large files)
*.csv
*.xlsx
*.json
!sample_*.csv

# Results and outputs
results/*.png
results/*.pdf
visualizations/*.png
visualizations/*.pdf

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db
"""
    
    with open('.gitignore', 'w') as f:
        f.write(gitignore_content)
    
    print("âœ… .gitignore created")
    return True

def run_quick_test():
    """Run a quick test to verify setup"""
    print("\nğŸ§ª Running setup verification...")
    
    try:
        # Test key imports
        import pandas as pd
        import numpy as np
        import matplotlib.pyplot as plt
        import sklearn
        import pgmpy
        import networkx as nx
        
        print("âœ… All required packages imported successfully")
        
        # Test basic functionality
        test_data = pd.DataFrame({
            'age': [45, 50, 60],
            'target': [0, 1, 1]
        })
        
        print("âœ… Pandas functionality verified")
        print("âœ… Setup verification completed successfully!")
        
        return True
        
    except ImportError as e:
        print(f"âŒ Import error: {e}")
        return False
    except Exception as e:
        print(f"âŒ Verification error: {e}")
        return False

def print_next_steps():
    """Print next steps for the user"""
    print("\nğŸ¯ NEXT STEPS")
    print("=" * 50)
    print("1. ğŸ“Š Download the dataset:")
    print("   â€¢ Visit: https://bit.ly/3T1A7Rs")
    print("   â€¢ Save as: heart_disease.csv")
    print("   â€¢ Place in project root directory")
    print()
    print("2. ğŸš€ Run the analysis:")
    print("   â€¢ Script version: python heart_disease_detective.py")
    print("   â€¢ Notebook version: jupyter notebook heart_disease_analysis.ipynb")
    print()
    print("3. ğŸ“‹ Review results:")
    print("   â€¢ Check generated visualizations")
    print("   â€¢ Read analysis reports")
    print("   â€¢ Validate medical insights")
    print()
    print("4. ğŸ”¬ Explore further:")
    print("   â€¢ Modify network structure")
    print("   â€¢ Try different discretization")
    print("   â€¢ Add new inference queries")

def main():
    """Main setup function"""
    print_header()
    
    # Check Python version
    if not check_python_version():
        sys.exit(1)
    
    # Install requirements
    if not install_requirements():
        print("âš ï¸  Some packages failed to install. Please install manually.")
    
    # Create project structure
    create_project_structure()
    
    # Create .gitignore
    create_gitignore()
    
    # Download dataset
    download_dataset()
    
    # Run verification test
    run_quick_test()
    
    # Print next steps
    print_next_steps()
    
    print("\nğŸ‰ PROJECT SETUP COMPLETE!")
    print("ğŸ•µï¸ Ready to start your Data Detective investigation!")

if __name__ == "__main__":
    main()
